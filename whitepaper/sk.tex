% This file is part of the SaveKepler project.
% Copyright 2013 the authors.

\documentclass[letterpaper,12pt,preprint]{aastex}
\usepackage{enumitem, color}
\definecolor{hypercolor}{RGB}{0,0,127}
\usepackage[%
  citecolor=hypercolor,%
  linkcolor=hypercolor,%
  urlcolor=hypercolor,%
  backref=false,%
  pagebackref=false%
]{hyperref}%

\newcommand{\sectionname}{Section}
\newcommand{\documentname}{\textsl{white paper}}
\newcommand{\foreign}[1]{\textit{#1}}
\newcommand{\vs}{\foreign{vs}}
\newcommand{\etal}{\foreign{et~al.}}
\newcommand{\observatory}[1]{\textsl{#1}}
\newcommand{\Kepler}{\observatory{Kepler}}
\newcommand{\TESS}{\observatory{TESS}}
\newcommand{\SDSS}{\observatory{SDSS}}
\newcommand{\WISE}{\observatory{WISE}}
\newcommand{\project}[1]{\textsl{#1}}
\newcommand{\MAST}{\project{MAST}}
\newcommand{\TheTractor}{\project{The~Tractor}}
\newcommand{\emcee}{\project{emcee}}
\newcounter{hoggitem}
\setcounter{hoggitem}{0}
\newcommand{\hoggitem}{\refstepcounter{hoggitem}\textbf{\textsl{(\thehoggitem)}}}

\newcommand\independent{\protect\mathpalette{\protect\independenT}{\perp}}
\def\independenT#1#2{\mathrel{\rlap{$#1#2$}\mkern2mu{#1#2}}}

\begin{document}\sloppy\sloppypar\thispagestyle{empty}

\title{Maximizing \Kepler\ science return per telemetered pixel: \\
  Detailed models of the focal plane in the two-wheel era}
\noindent
A white paper submitted in response to the \Kepler\ Project Office
\textit{Call for White Papers: Soliciting Community Input for
  Alternate Science Investigations for the Kepler
  Spacecraft}\footnote{\url{http://keplergo.arc.nasa.gov/docs/Kepler-2wheels-call-1.pdf}}
released 2013 August 02.

\begin{description}[style=nextline,itemsep=0ex]
\item[David W. Hogg]
\textit{Center for Cosmology and Particle Physics, New York University}
\item[Ruth Angus]
\textit{Department of Physics, Oxford University}
\item[Tom Barclay]
\textit{NASA Ames Research Center}
\item[Rebekah Dawson]
\textit{Havard--Smithsonian Center for Astrophysics}
\item[Rob Fergus]
\textit{Courant Institute of Mathematical Sciences, New York University}
\item[Dan Foreman-Mackey]
\textit{Center for Cosmology and Particle Physics, New York University}
\item[Michael Hirsch]
\textit{Max-Planck-Institut f\"ur Intelligente Systeme}
\item[Dustin Lang]
\textit{McWilliams Center for Cosmology, Carnegie Mellon University}
\item[Ben Montet]
\textit{Department of Astronomy, California Institute of Technology}
\item[David Schiminovich]
\textit{Department of Astrophysics, Columbia University}
\item[Bernhard Sch\"olkopf]
\textit{Max-Planck-Institut f\"ur Intelligente Systeme}
\end{description}

\clearpage

\section{Executive summary}

\paragraph{primary recommendation:}
\hoggitem~Fundamentally, this \documentname\ advocates \emph{image modeling}%
  ---building a detailed model of pixel sensitivities
  (including possibly intra-pixel sensitivity maps),
  point-spread function,
  and sky, bias, and dark signals,
  all as a function of focal-plane position%
  ---along with a model of the position and brightness of every star in the field.
This level of modeling has not happened with \Kepler\ up to now
  because the data have been made extremely precise with good pointing
  and aperture photometry.
In the two-wheel era, \Kepler\ will not maintain precise pointing.
This is a blessing as well as a curse:
It reduces the precision of naive aperture photometry,
  but it provides data diversity that permits inference
  of the sensitivity map and point-spread function
  that is not perfectly covariant with the morphology of the true scene.
We propose capitalizing on this to
  \textbf{develop a probabilistic generative model of the \Kepler\ pixels.}
We argue that this modeling may permit continuance of photometry at 10-ppm-level precision.
We demonstrate baby steps towards focal-plane models
  along two different directions:
In one, the model is physical;
  its parameters are parameters of the spacecraft, detectors, and optics.
In the other, the model is data-driven but motivated by ideas of causality;
  in this case the parameters control the ways
  disparate data sources can be used to predict one another.
We demonstrate that the expected drift or jitter in positions in the two-weel era
  will \textsl{(a)}~help with constraining these kinds of model,
  and \textsl{(b)}~be obviated (in terms of loss of precision) by such modeling.
These results are relevant to \emph{almost any} scientific goal for the repurposed mission,
  independent of our secondary recommendations.

\paragraph{secondary recommendations:}
\hoggitem~If \Kepler\ continues to observe the current \Kepler\ field,
  we would recommend shortening exposure times to about 5\,min, and increasing cadence,
  to reduce the effect of pointing drift and increase the sensitivity of the models.
Increased cadence will lead to better value of the data for measuring
  transit-timing and transit-duration variations.
If \Kepler\ switches to observing a set of new but specially chosen ``low-torque'' fields,
  it could continue with its current exposure times (of about 30\,min).

\hoggitem~The telemetry burden of any increase in cadence can be offset
  by reducing the number of target stars.
We would recommend (for scientific reasons) aggressively shrinking the target lists around
  bright, non-variable Sun-like and M-type stars.

\hoggitem~It will be imperative to operate the spacecraft
  with one or both of the following modifications to operational software:
Either the pointing will need to be adjusted frequently using
  the two operational wheels and some propellant;
  or else the focal-plane apertures telemetered down at each detector
  read will have to be adapted in real time to follow drifting stars.

\hoggitem~It will also be wise to further capitalize on the ``blessing'' of the drift
  by diversifying the observations in other ways:
Deliberate focus pulls, dithers, and integration-time adjustments,
  either throughout the mission
  or else in specified ``calibration periods''
  will provide much more data support for hard-to-constrain model parameters.

\hoggitem~Whether the two-wheel survey strategy ends up being
  to continue observations in the current \Kepler\ field,
  or to work in the low-torque fields%
  ---we discuss scientific suvey strategies in a companion \documentname\ (by Montet et al.)---%
  it is our view that \Kepler\ can still accomplish
  what many of the present authors consider its key scientific goal,
  which is \textbf{to find Earth-like planets on year-ish orbits around Sun-like stars}.
With a multi-pronged image-modeling effort and
  a bit of good luck
  (with respect to assumptions about spacecraft hardware and data-modeling software),
  it is our view that a two-wheeled \Kepler\ can still
  be used to pursue this deep and important mission.
That said, what's written in this \documentname\ is fundamentally
  agnostic about the scientific program in the two-wheel era.

\clearpage

\section{Philosophy and motivation}

Image modeling will deliver many bits; we will get more science per
downloaded pixel than the naive predictions of degradation.

\Kepler\ data are taken in a mode that is
near-pessimal\footnote{Neologism ``pessimal'' is the antonym of
  ``optimal''.} for the determination or inference of calibration
parameters such as point-spread function, pixel-level or large-scale
sensitivity map, bias, dark, sky, or contributions from overlapping
sources.

\Kepler\ core goals remain outrageously interesting.

We know a lot about the prevalance of planets and the stars in which
we could possibly detect them; we should use this to reduce our data
volume.

TESS is coming; we can help with that.

Asteroseismology and transit timing variations both benefit from
shorter cadence.

If using such fields becomes a requirement of the repurposed mission,
  this would recommend against making year-ish orbit planets a high priority.
  (this isn't necessarily true! If \Kepler\ changes pointings every 20 days, returning to the same pointing once
  per year, it will still be well-positioned to observe transits of certain planets; i.e. planets that transit
  once per year. It will only find 1/~20 of them in each field, but will look at 20 fields per year, so the
  net number of 1AU planets observed will be conserved. Difficulty: 180 day planets will also be observed once/year,
  as will 90, 45, etc. Can be dealt with statistically, through transit durations, and/or with space-based follow up
  (ie JWST) -btm  Okay I agree with this; let's move this to whitepaper 2! -Hogg)

One final point of philosophy:
All of the code used to make the demonstrations in this \documentname
  are available as open-source or at least publicly readable code on the web.%
\footnote{Our toy future-data simulation---and code for physical modeling thereof---is at
  \url{http://astrometry.net/svn/trunk/projects/kepler/};
  it is a sub-project of our general image-modeling framework
  called ``\TheTractor'' (\citealt{hoggtractor}, \citealt{langtractor}), which is at
  \url{http://theTractor.org/}.
  Our data-driven modeling code is at
  \url{https://github.com/dfm/causal-kepler}.
  Code to build physical models of the pixels in the extant \Kepler\ data is at
  \url{https://github.com/dfm/kpsf}.
  Our Python wrapping of the \MAST\ interface to the \Kepler\ data is at
  \url{https://github.com/dfm/kplr},
  and most of our probabilistic inference involves ensemble sampling
  with \emcee\ (\citealt{emcee}), which is at
  \url{http://dan.iel.fm/emcee/}.}
We encourage the \Kepler\ community to fork, build on, and contribute back to these code bases.

\section{Modeling of extant \Kepler\ data}\label{sec:extant}

\subsection{Data-driven conditional models of Kepler data}

Suppose we are given a number of time series
$$(y_i(t_j))_{i=1,\dots,n; j=1,\dots,T}$$
where $y_i(t_j)$ is the read out intensity of pixel $i$ at time $t_j$.

We assume that $y_i(t_j)$ is a function of the following variables:
\begin{itemize}
\item
the true flux $f_i(t_j)$ arriving at the location of pixel $i$ during the
integration time
\item
confounding factors inherent to the spacecraft, affecting all pixels (but not
necessarily the same way (e.g., temperature, pointing errors)
\item
confounders related to the position of the spacecraft, e.g., $\pi/2$ rotations
around the optical axis, or position angle of the spacecraft on its orbit
around the sun
\item
HOGG: if there's anything else, add it here
\end{itemize}

Our goal is to model the true fluxes, but this maybe be hard if we cannot get
a handle on the values of the confounders, nor on the precise mechanisms by
which the confounders affect the measurements $y_i(t_j)$.

However, we can apply a data-driven approach which attempts to remove the
confounding effects influencing $y_i(t_j)$ in as far as they can be predicted
from the other time series $y_{i'}(t_j)$, $i'\ne i$. (N.B.: whenever we write
$i\ne i'$, it is understood that the two pixels $i$ and $i'$ should belong to
different stars with non-overlapping PSFs.)

This relies on the following assumptions:
\begin{itemize}
\item Independence:
we assume that the true fluxes are independent, i.e., $f_i(t_j) \independent
f_{i'}(t_{j'})$ for all $i\ne i', j,j'=1,\dots,T$.
We also assume there may be additional observables (e.g.\ temperature) for
which this independence holds.
\item Joint confounding:
we assume that any confounder affecting $y_i(t_j)$ for some $i,j$ will also
affect a number of other values $y_{i'}(t_{j'})$ (where $i\ne i',
j,j'=1,\dots,T$), in the sense that the overall confounding effect on
$y_i(t_j)$ can in principle be predicted from from the confounding effects
on the other $y_{i'}(t_{j'})$.
\end{itemize}
To motivate our independence assumption, we refer to Reichenbach's principle
\citep{Reichenbach1956}. It states that whenever we find two observables to be
statistically dependent, then there must be an underlying causal structure
responsible for these dependences. This structure can be a direct causal link,
or an unobserved confounder affecting both observables. Vice versa, if there
is no causal structure connecting both observables, they must be statistically
independent.

The idea behind our approach is that if we now try to predict a measurement
$y_i(t_j)$ (or features thereof, such as the local time derivative) from
variables known to be \emph{independent} of $f_i(t_j)$ (the true flux), then
whatever we \emph{can} predict has nothing to do with $f_i(t_j)$. Whatever is
predictable better than chance (i.e., whatever statistical dependence we find)
must, by Reichenbach's principle, be due to joint confounders that affect both
our measurement and the other variables we are using to predict it.

Our goal should thus be to factor out exactly that influence. This is
particularly easy if the following assumption holds true (although it may
also be possible in a more general case):
\begin{itemize}
\item
we assume that the confounding effects are additive, i.e.,
\begin{equation}
\label{confounding}
y_i(t_j) = f_i(t_j) + c\left( (f_{i'}(t_j))_{i'\ne i'; j=1,\dots,T}\right),
\mbox{~where~} i\ne i'
\end{equation}
\end{itemize}

If all of the above assumptions hold true, we propose to estimate $c$ by
training an auto-regressive model to predict $y_i(t_j)$ from
$(f_{i'}(t_j))_{i'\ne i'; j=1,\dots,T}$.
Note that predicting $y_i(t_j)$ is \emph{not} the same as predicting $c$.
However, by (\ref{confounding}), they only differ by $f_i(t_j)$, which by the
independence assumption \emph{cannot} be predicted from
$(f_{i'}(t_j))_{i'\ne i'; j=1,\dots,T}$ -- for the regression, this is
``noise'' (even though for us, it's the main signal).

Suppose we are only interested in the \emph{dips} in the light curves (i.e.,
we now think of $f_i$ as the fraction of star light that is not occluded by
the exoplanet --- all the star's brightness fluctuations are now considered
as confounding effects). In this case, we can make the model more specific by
also using information from the past of the pixel time series we are trying
to predict. In this case, the independence  $f_i(t_j) \independent
f_{i'}(t_{j'})$ holds true,
\begin{enumerate}
\item as above, for all $i\ne i', j,j'=1,\dots,T$, and
\item for $i=i'$, $|j-j'|>\delta$ where $\delta$ is an upper bound on the
    expected duration of a transit.
\end{enumerate}
This independence assumption also has a physical interpretation: in addition
to all the above independences, the star's light emission is independent of
where the planet is located around the star. Therefore, the light arriving
from the star system contains no information about the dip in the light curve
except while the planet is in front of (or behind) the star. This can be
viewed as an assumption of independence of input (star brightness
distribution) and conditional (i.e., the occluding mechanism by which the
star-planet system ``converts'' the star brightness into an observable
brightness of the joint system. This kind of assumption has recently studied
in the field of causal inference \citep{JanSch10}.

\section{Toy simulations of future data}\label{sec:future}

\section{Target selection}\label{sec:target}

\section{Spacecraft pointing}\label{sec:pointing}

\section{Aperture selection for telemetry}\label{sec:telemetry}

\section{Calibration strategy}\label{sec:calibration}

Will self-cal be enough?

Should we pull focus and dither and exercise exposure time options?

\section{Possible showstoppers}\label{sec:stop}

In principle any physical effect can be covered by the modeling
methods we propose.

Heterogeneity or time dependence in intrapixel sensitivity variations
could be very difficult to model.

Propose multipole expansion to begin to address this.

\section{Acknowledgments}

DFM would like to thank Sameer Agarwal (Google) and Keir Mierle (Locu) for
releasing the Ceres non-linear least squares solver
(\url{https://code.google.com/p/ceres-solver/}) and for making suggestions
that enabled this work.

% ---
% despite what astronomers say, let's put titles in the references
% ---
\begin{thebibliography}{}\raggedright%

\bibitem[Foreman-Mackey \etal(2013)]{emcee}
Foreman-Mackey,~D., Hogg,~D.~W., Lang,~D., \& Goodman,~J., 2013,
\emcee:\ The MCMC Hammer,
\pasp, 125, 306--312.

\bibitem[Hogg \& Lang(2013)]{hoggtractor}
Hogg,~D.~W. \& Lang,~D., 2013,
Replacing standard galaxy profiles with mixtures of Gaussians,
\pasp, 125, 719--730

\bibitem[Lang \& Hogg(2014)]{langtractor}
Lang,~D. \& Hogg,~D.~W., 2014,
\TheTractor:\ A framework for image modeling, with applications to \SDSS, \WISE, and \Kepler,
in preparation

\bibitem[Janzing \& Sch{\"o}lkopf(2010)]{JanSch10}
Janzing,~D.\ \& Sch{\"o}lkopf,~B., 2010,
% DFM NEED TITLE
IEEE Transactions on Information
Theory, 56, 5168

\bibitem[Reichenbach(1956)]{Reichenbach1956}
Reichenbach,~H., \emph{The Direction of Time}, University of California
Press, 1956

\end{thebibliography}

\end{document}
